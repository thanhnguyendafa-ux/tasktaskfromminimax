"use strict";(()=>{var e={};e.id=340,e.ids=[340],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6938:(e,o,t)=>{t.r(o),t.d(o,{originalPathname:()=>_,patchFetch:()=>x,requestAsyncStorage:()=>l,routeModule:()=>u,serverHooks:()=>m,staticGenerationAsyncStorage:()=>c});var r={};t.r(r),t.d(r,{POST:()=>d});var s=t(9303),a=t(8716),n=t(670),i=t(7070),p=t(5662);async function d(e,{params:o}){try{let{aborted:t=!1}=await e.json(),{data:r,error:s}=await p.O.from("pomodoro_sessions").select("*, task_id, user_id").eq("id",o.id).single();if(s||!r)return i.NextResponse.json({error:"Session not found"},{status:404});let{data:a,error:n}=await p.O.from("pomodoro_sessions").update({completed_at:new Date().toISOString(),status:t?"aborted":"completed"}).eq("id",o.id).select().single();if(n)return i.NextResponse.json({error:n.message},{status:500});if(t)return i.NextResponse.json({session:a});let{data:d}=await p.O.from("tasks").select("pomodoro_count").eq("id",r.task_id).single();await p.O.from("tasks").update({pomodoro_count:(d?.pomodoro_count||0)+1,last_active_at:new Date().toISOString()}).eq("id",r.task_id);let{data:u}=await p.O.from("profiles").select("xp, coins, level").eq("id",r.user_id).single();if(u){let e=u.xp+5,o=Math.floor(e/100)+1,t=o>u.level;return await p.O.from("profiles").update({xp:e,coins:u.coins+2,last_active_at:new Date().toISOString()}).eq("id",r.user_id),i.NextResponse.json({session:a,rewards:{xp_earned:5,coins_earned:2,level_up:t,new_level:o}})}return i.NextResponse.json({session:a,rewards:{xp_earned:5,coins_earned:2}})}catch(e){return i.NextResponse.json({error:"Internal server error"},{status:500})}}let u=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/pomodoro/[id]/complete/route",pathname:"/api/pomodoro/[id]/complete",filename:"route",bundlePath:"app/api/pomodoro/[id]/complete/route"},resolvedPagePath:"D:\\vibecode\\tasktask\\app\\api\\pomodoro\\[id]\\complete\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:l,staticGenerationAsyncStorage:c,serverHooks:m}=u,_="/api/pomodoro/[id]/complete/route";function x(){return(0,n.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:c})}},5662:(e,o,t)=>{t.d(o,{N:()=>a,O:()=>s});var r=t(7857);let s=(0,r.eI)("https://your-project.supabase.co","your-anon-key"),a=()=>(0,r.eI)("https://your-project.supabase.co","your-anon-key")}};var o=require("../../../../../webpack-runtime.js");o.C(e);var t=e=>o(o.s=e),r=o.X(0,[276,564],()=>t(6938));module.exports=r})();