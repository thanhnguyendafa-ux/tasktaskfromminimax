"use strict";(()=>{var e={};e.id=133,e.ids=[133],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3233:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>h,patchFetch:()=>x,requestAsyncStorage:()=>c,routeModule:()=>d,serverHooks:()=>l,staticGenerationAsyncStorage:()=>f});var s={};r.r(s),r.d(s,{POST:()=>u});var o=r(9303),n=r(8716),a=r(670),i=r(7070),p=r(5662);async function u(e){try{let{user_id:t,food_id:r}=await e.json();if(!t||!r)return i.NextResponse.json({error:"User ID and Food ID required"},{status:400});let{data:s,error:o}=await p.O.from("pet_foods").select("*").eq("id",r).single();if(o||!s)return i.NextResponse.json({error:"Food not found"},{status:404});let{data:n,error:a}=await p.O.from("profiles").select("coins").eq("id",t).single();if(a||!n)return i.NextResponse.json({error:"Profile not found"},{status:404});if(n.coins<s.price_coins)return i.NextResponse.json({error:"Not enough coins"},{status:400});let{data:u,error:d}=await p.O.from("user_pets").select("*").eq("user_id",t).single();if(d||!u)return i.NextResponse.json({error:"Pet not found"},{status:404});await p.O.from("profiles").update({coins:n.coins-s.price_coins}).eq("id",t);let c=Math.min(100,u.hunger+s.hunger_restore),f=Math.min(100,u.happiness+s.happiness_bonus),l=u.experience+s.xp_bonus,{data:h,error:x}=await p.O.from("user_pets").update({hunger:c,happiness:f,experience:l,last_fed_at:new Date().toISOString(),state:"eating",mood:"excited",updated_at:new Date().toISOString()}).eq("id",u.id).select().single();if(x)return i.NextResponse.json({error:x.message},{status:500});return i.NextResponse.json({pet:h,fed:{food_name:s.name,hunger_restored:s.hunger_restore,happiness_bonus:s.happiness_bonus,xp_earned:s.xp_bonus}})}catch(e){return i.NextResponse.json({error:"Internal server error"},{status:500})}}let d=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/pet/feed/route",pathname:"/api/pet/feed",filename:"route",bundlePath:"app/api/pet/feed/route"},resolvedPagePath:"D:\\vibecode\\tasktask\\app\\api\\pet\\feed\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:c,staticGenerationAsyncStorage:f,serverHooks:l}=d,h="/api/pet/feed/route";function x(){return(0,a.patchFetch)({serverHooks:l,staticGenerationAsyncStorage:f})}},5662:(e,t,r)=>{r.d(t,{O:()=>s});let s=(0,r(7857).eI)("https://your-project.supabase.co","your-anon-key")}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[276,564],()=>r(3233));module.exports=s})();