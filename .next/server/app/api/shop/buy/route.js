"use strict";(()=>{var e={};e.id=403,e.ids=[403],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},103:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>f,patchFetch:()=>x,requestAsyncStorage:()=>c,routeModule:()=>d,serverHooks:()=>m,staticGenerationAsyncStorage:()=>l});var s={};t.r(s),t.d(s,{POST:()=>p});var o=t(9303),n=t(8716),i=t(670),a=t(7070),u=t(5662);async function p(e){try{let{user_id:r,item_id:t}=await e.json();if(!r||!t)return a.NextResponse.json({error:"User ID and Item ID required"},{status:400});let{data:s,error:o}=await u.O.from("shop_items").select("*").eq("id",t).single();if(o||!s)return a.NextResponse.json({error:"Item not found"},{status:404});let{data:n,error:i}=await u.O.from("profiles").select("coins").eq("id",r).single();if(i||!n)return a.NextResponse.json({error:"Profile not found"},{status:404});if(n.coins<s.price_coins)return a.NextResponse.json({error:"Not enough coins"},{status:400});let{data:p}=await u.O.from("user_inventory").select("*").eq("user_id",r).eq("item_id",t).single();if(p)return a.NextResponse.json({error:"Already owned"},{status:400});let{error:d}=await u.O.from("profiles").update({coins:n.coins-s.price_coins}).eq("id",r);if(d)return a.NextResponse.json({error:d.message},{status:500});let{data:c,error:l}=await u.O.from("user_inventory").insert({user_id:r,item_id:t}).select("*, item:item_id(*)").single();if(l)return a.NextResponse.json({error:l.message},{status:500});return a.NextResponse.json({item:c,remaining_coins:n.coins-s.price_coins},{status:201})}catch(e){return a.NextResponse.json({error:"Internal server error"},{status:500})}}let d=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/shop/buy/route",pathname:"/api/shop/buy",filename:"route",bundlePath:"app/api/shop/buy/route"},resolvedPagePath:"D:\\vibecode\\tasktask\\app\\api\\shop\\buy\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:c,staticGenerationAsyncStorage:l,serverHooks:m}=d,f="/api/shop/buy/route";function x(){return(0,i.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:l})}},5662:(e,r,t)=>{t.d(r,{O:()=>s});let s=(0,t(7857).eI)("https://your-project.supabase.co","your-anon-key")}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[276,564],()=>t(103));module.exports=s})();